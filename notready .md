### IPSec Framework: Этапы, Методы и Протоколы

IPSec (Internet Protocol Security) — это набор протоколов, обеспечивающих безопасность интернет-протокола (IP) посредством аутентификации и шифрования данных. Основные этапы и протоколы IPSec включают две фазы IKE и несколько специфических протоколов, таких как AH и ESP.

#### 1. IKE Phase 1 (Internet Key Exchange Phase 1)
IKE (Internet Key Exchange) — это протокол, используемый для установки защищенных и аутентифицированных соединений между двумя узлами (или хостами). IKE фаза 1 предназначена для установления защищенного и аутентифицированного канала между узлами.

Этапы IKE фазы 1:
- **Negotiation**: Сначала происходит согласование и выбор параметров безопасности, включая алгоритмы шифрования, хэш-функции, время жизни ключей и т. д.
- **Exchange of Keys**: Используется метод обмена ключами Диффи-Хеллмана (Diffie-Hellman) для генерации общих ключей шифрования.
- **Authentication**: Взаимная аутентификация сторон с помощью паролей, цифровых сертификатов или других методов.
- **Establishment of ISAKMP SA (Security Association)**: После завершения вышеуказанных процессов создается ISAKMP SA — ассоциация безопасности, которая будет использоваться для защиты дальнейших сообщений.

IKE фаза 1 может использовать два режима:
- **Main Mode**: Шесть сообщений используются для настройки SA. Этот режим обеспечивает лучшую безопасность.
- **Aggressive Mode**: Быстрее, использует три сообщения, но менее безопасен по сравнению с основным режимом.

#### 2. IKE Phase 2 (Internet Key Exchange Phase 2)
После успешного завершения IKE фазы 1 начинается IKE фаза 2. Она направлена на создание "IPSec SA" для защиты данных, передаваемых между узлами.

Этапы IKE фазы 2:
- **Negotiation of IPSec SA Parameters**: Взаимная договоренность о параметрах безопасности для шифрования и проверки целостности передаваемых данных.
- **Quick Mode**: Используется для обмена информацией, необходимой для установки и обновления IPSec SA.
- **Establishment of IPSec SA**: На основе установленных параметров создаются IPSec SA, которые будут использоваться для шифрования и аутентификации данных.

IKE фаза 2 часто работает в **Quick Mode** (быстрый режим), который использует три сообщения для завершения обмена.

#### 3. Протоколы IPSec
IPSec включает несколько ключевых протоколов:

- **AH (Authentication Header)**: Этот протокол обеспечивает целостность данных и аутентификацию, но не шифрует данные. AH добавляет заголовок, который используется для проверки целостности данных и подлинности источника пакетов.
  
- **ESP (Encapsulating Security Payload)**: Основной протокол IPSec, обеспечивающий конфиденциальность данных путем их шифрования, а также их аутентификацию и целостность. ESP может работать в двух режимах:
  - **Transport Mode**: Шифруется только полезная нагрузка IP-пакета, IP-заголовок остается нетронутым.
  - **Tunnel Mode**: Весь IP-пакет (включая заголовок) шифруется и инкапсулируется в новый IP-пакет с новым заголовком.

#### 4. HTTP vs HTTPS
HTTP (Hypertext Transfer Protocol) и HTTPS (Hypertext Transfer Protocol Secure) — это протоколы прикладного уровня, используемые для передачи данных в Интернете.

- **HTTP**: Некриптованный протокол, использующий порт 80. Все данные передаются в открытом виде, что делает его уязвимым для атак типа «человек посередине» (MITM).

- **HTTPS**: Шифрованная версия HTTP, использующая SSL/TLS для защиты передаваемых данных. Работает через порт 443. HTTPS обеспечивает конфиденциальность, целостность данных и аутентификацию сервера, что делает его более безопасным по сравнению с HTTP.

Таким образом, HTTPS защищает данные, передаваемые между клиентом и сервером, в то время как IPSec защищает данные на сетевом уровне, обеспечивая безопасное взаимодействие между сетевыми узлами.

## Описание нескольких лучших практик по использованию SSH (Secure Shell):

1. **Используйте ключи SSH вместо паролей**: Генерация пары ключей (публичный и приватный) обеспечивает более высокий уровень безопасности по сравнению с паролями.

2. **Отключите вход по паролю**: После настройки ключей SSH отключите возможность входа по паролю, чтобы предотвратить атаки методом подбора.

3. **Измените стандартный порт SSH**: По умолчанию SSH работает на порту 22. Изменение порта может снизить количество автоматических атак.

4. **Используйте брандмауэр**: Настройте брандмауэр для ограничения доступа к вашему SSH-серверу только с определённых IP-адресов.

5. **Регулярно обновляйте программное обеспечение**: Убедитесь, что ваш SSH-сервер и клиент всегда обновлены до последних версий для защиты от уязвимостей.

6. **Настройте двухфакторную аутентификацию (2FA)**: Это добавляет дополнительный уровень защиты к вашему SSH-доступу.

7. **Ограничьте доступ пользователей**: Создайте группы пользователей и предоставьте доступ только тем, кто действительно нуждается в нём.

8. **Используйте `Fail2Ban` или аналогичные инструменты**: Эти инструменты могут заблокировать IP-адреса после нескольких неудачных попыток входа.

9. **Мониторинг и аудит**: Ведите журналы входа и регулярно проверяйте их на предмет подозрительной активности.

10. **Регулярно меняйте ключи**: Периодическая замена ключей SSH помогает предотвратить несанкционированный доступ.

Следуя этим рекомендациям, вы можете значительно повысить безопасность вашего SSH-доступа.
</details>

# 2. SSH Best Practice.

### 1: Установка необходимых приложений

  1.1 Устанавливаем ssh

` sudo apt update `
` sudo apt install openssh-client openssh-server `

  1.2 Генерация SSH-ключей

   ` ssh-keygen -t rsa -b 4096 -f ~/.ssh/tms/id_rsa `
   
Затем вводим пароль или оставляем поле пустым 

### 2. Проверяем сгенерированые ключи
При помощи команды `ls` проверяем наличие ключей 
`
ls ~/.ssh/tms/
`![проверка ключей](https://github.com/user-attachments/assets/bdcc42a7-1a92-4978-9fbf-cd2158f42b73)

### 3. Добавление приватного ключа в ssh-agent

  3.1 Запустите ssh-agent:

     `eval "$(ssh-agent -s)"`

  3.2 Добавьте ваш приватный ключ в ssh-agent:

     `ssh-add ~/.ssh/tms/id_rsa `
### 4. Копирование публичного ключа на удалённый сервер

Командой `ssh-copy-id` копируюем ключ на удаленный сервер. 

   ` ssh-copy-id -i ~/.ssh/tms/id_rsa.pub user@10.10.0.6 `

При помощи команды ssh `user@10.10.0.6` проверяем подключение к удаленному серверу 
![ssh](https://github.com/user-attachments/assets/754e4722-c479-4f3c-8e5b-8d59cf907100)

