### IPSec Framework: Этапы, Методы и Протоколы

IPSec (Internet Protocol Security) — это набор протоколов, обеспечивающих безопасность интернет-протокола (IP) посредством аутентификации и шифрования данных. Основные этапы и протоколы IPSec включают две фазы IKE и несколько специфических протоколов, таких как AH и ESP.

#### 1. IKE Phase 1 (Internet Key Exchange Phase 1)
IKE (Internet Key Exchange) — это протокол, используемый для установки защищенных и аутентифицированных соединений между двумя узлами (или хостами). IKE фаза 1 предназначена для установления защищенного и аутентифицированного канала между узлами.

Этапы IKE фазы 1:
- **Negotiation**: Сначала происходит согласование и выбор параметров безопасности, включая алгоритмы шифрования, хэш-функции, время жизни ключей и т. д.
- **Exchange of Keys**: Используется метод обмена ключами Диффи-Хеллмана (Diffie-Hellman) для генерации общих ключей шифрования.
- **Authentication**: Взаимная аутентификация сторон с помощью паролей, цифровых сертификатов или других методов.
- **Establishment of ISAKMP SA (Security Association)**: После завершения вышеуказанных процессов создается ISAKMP SA — ассоциация безопасности, которая будет использоваться для защиты дальнейших сообщений.

IKE фаза 1 может использовать два режима:
- **Main Mode**: Шесть сообщений используются для настройки SA. Этот режим обеспечивает лучшую безопасность.
- **Aggressive Mode**: Быстрее, использует три сообщения, но менее безопасен по сравнению с основным режимом.

#### 2. IKE Phase 2 (Internet Key Exchange Phase 2)
После успешного завершения IKE фазы 1 начинается IKE фаза 2. Она направлена на создание "IPSec SA" для защиты данных, передаваемых между узлами.

Этапы IKE фазы 2:
- **Negotiation of IPSec SA Parameters**: Взаимная договоренность о параметрах безопасности для шифрования и проверки целостности передаваемых данных.
- **Quick Mode**: Используется для обмена информацией, необходимой для установки и обновления IPSec SA.
- **Establishment of IPSec SA**: На основе установленных параметров создаются IPSec SA, которые будут использоваться для шифрования и аутентификации данных.

IKE фаза 2 часто работает в **Quick Mode** (быстрый режим), который использует три сообщения для завершения обмена.

#### 3. Протоколы IPSec
IPSec включает несколько ключевых протоколов:

- **AH (Authentication Header)**: Этот протокол обеспечивает целостность данных и аутентификацию, но не шифрует данные. AH добавляет заголовок, который используется для проверки целостности данных и подлинности источника пакетов.
  
- **ESP (Encapsulating Security Payload)**: Основной протокол IPSec, обеспечивающий конфиденциальность данных путем их шифрования, а также их аутентификацию и целостность. ESP может работать в двух режимах:
  - **Transport Mode**: Шифруется только полезная нагрузка IP-пакета, IP-заголовок остается нетронутым.
  - **Tunnel Mode**: Весь IP-пакет (включая заголовок) шифруется и инкапсулируется в новый IP-пакет с новым заголовком.

#### 4. HTTP vs HTTPS
HTTP (Hypertext Transfer Protocol) и HTTPS (Hypertext Transfer Protocol Secure) — это протоколы прикладного уровня, используемые для передачи данных в Интернете.

- **HTTP**: Некриптованный протокол, использующий порт 80. Все данные передаются в открытом виде, что делает его уязвимым для атак типа «человек посередине» (MITM).

- **HTTPS**: Шифрованная версия HTTP, использующая SSL/TLS для защиты передаваемых данных. Работает через порт 443. HTTPS обеспечивает конфиденциальность, целостность данных и аутентификацию сервера, что делает его более безопасным по сравнению с HTTP.

Таким образом, HTTPS защищает данные, передаваемые между клиентом и сервером, в то время как IPSec защищает данные на сетевом уровне, обеспечивая безопасное взаимодействие между сетевыми узлами.
